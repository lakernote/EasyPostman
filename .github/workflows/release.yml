name: Release Buildï¼ˆå‘å¸ƒæ„å»ºï¼‰

permissions:
  contents: write

on:
  release:
    types: [ created ]  # å½“åˆ›å»ºæ–°çš„ Release æ—¶è§¦å‘
  workflow_dispatch: { }  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

env:
  JAVA_VERSION: '17'
  JAVA_DISTRIBUTION: 'jetbrains'  # ä½¿ç”¨ JetBrains Runtimeï¼ˆJBRï¼‰ï¼Œä¸º Swing åº”ç”¨ä¼˜åŒ–
  # ç²¾ç®€åçš„æ¨¡å—é…ç½®ï¼ˆå·²ç§»é™¤æœªä½¿ç”¨çš„æ¨¡å—ï¼Œé¢„è®¡å‡å°‘ 10-15 MBï¼‰
  # ç§»é™¤ï¼šjava.namingï¼ˆæ— JNDIï¼‰ã€java.net.httpï¼ˆç”¨OkHttpï¼‰ã€java.prefsï¼ˆæ— Preferences APIï¼‰
  #       java.security.saslï¼ˆæ— SASLï¼‰ã€java.management.rmiï¼ˆæ¡Œé¢åº”ç”¨ï¼‰ã€jdk.crypto.cryptokiï¼ˆæ— ç¡¬ä»¶åŠ å¯†ï¼‰
  JLINK_MODULES: 'java.base,java.desktop,java.logging,jdk.unsupported,java.sql,java.security.jgss,jdk.crypto.ec,java.management'
  JAVA_OPTIONS: '-Xms256m|-Xmx512m|-Dfile.encoding=UTF-8'

jobs:
  # æå–ç‰ˆæœ¬å·ï¼Œä¾›æ‰€æœ‰ job å¤ç”¨
  get-version:
    name: Get Versionï¼ˆè·å–ç‰ˆæœ¬å·ï¼‰
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.extract_version.outputs.version }}
    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          cache: 'maven'
          check-latest: false  # ç¦ç”¨æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å… GitHub API é€Ÿç‡é™åˆ¶
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # ä½¿ç”¨ token æé«˜ API é€Ÿç‡é™åˆ¶

      - name: Extract versionï¼ˆæå–ç‰ˆæœ¬å·ï¼‰
        id: extract_version
        run: |
          VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)
          echo "Version: $VERSION"
          echo "version=$VERSION" >> $GITHUB_OUTPUT

  # æ„å»º Fat JARï¼ˆè·¨å¹³å°ï¼‰ï¼Œä¾›æ‰€æœ‰å¹³å°å¤ç”¨
  build-jar-artifact:
    name: Build Fat JARï¼ˆæ„å»ºè·¨å¹³å° JARï¼‰
    runs-on: ubuntu-latest
    needs: [ get-version ]
    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          cache: 'maven'
          check-latest: false  # ç¦ç”¨æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å… GitHub API é€Ÿç‡é™åˆ¶
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # ä½¿ç”¨ token æé«˜ API é€Ÿç‡é™åˆ¶

      - name: Build with Mavenï¼ˆä½¿ç”¨ Maven æ„å»º Fat JARï¼‰
        run: mvn -B clean package -DskipTests

      - name: Upload JAR for reuseï¼ˆä¸Šä¼  JAR ä¾›å…¶ä»– job å¤ç”¨ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: app-jar
          path: target/easy-postman-${{ needs.get-version.outputs.version }}.jar
          retention-days: 1




  build-windows-portable:
    name: Build Windows Portableï¼ˆæ„å»º Windows ç»¿è‰²ç‰ˆï¼‰
    runs-on: windows-latest
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false  # ç¦ç”¨æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å… GitHub API é€Ÿç‡é™åˆ¶

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º Windows ç²¾ç®€ JREï¼‰
        shell: pwsh
        run: |
          $runtimeDir = "target\runtime"
          if (Test-Path $runtimeDir) { Remove-Item -Recurse -Force $runtimeDir }
          
          jlink `
            --add-modules $env:JLINK_MODULES `
            --strip-java-debug-attributes `
            --strip-native-commands `
            --strip-debug `
            --no-header-files `
            --no-man-pages `
            --compress=2 `
            --verbose `
            --output $runtimeDir
          
          # éªŒè¯ JRE å¤§å°
          $size = (Get-ChildItem -Path $runtimeDir -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
          Write-Host "âœ… JRE åˆ›å»ºæˆåŠŸï¼Œå¤§å°: $([math]::Round($size, 2)) MB"

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $jarNameWithVersion = "easy-postman-$version.jar"
          $jarName = "easy-postman.jar"
          
          $distInputDir = "target\dist-input"
          if (Test-Path $distInputDir) { Remove-Item -Recurse -Force $distInputDir }
          New-Item -ItemType Directory -Path $distInputDir | Out-Null
          
          # é‡å‘½å JAR ä¸ºå›ºå®šåç§°ï¼ˆå»é™¤ç‰ˆæœ¬å·ï¼‰
          Copy-Item "target\$jarNameWithVersion" -Destination "$distInputDir\$jarName"

      - name: Create app-image with jpackageï¼ˆåˆ›å»ºåº”ç”¨é•œåƒï¼Œå…å®‰è£…ï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $jarName = "easy-postman.jar"
          $appImageDir = "target\app-image"
          
          if (Test-Path $appImageDir) { Remove-Item -Recurse -Force $appImageDir }
          
          # è§£æ Java é€‰é¡¹
          $javaOpts = $env:JAVA_OPTIONS -split '\|'
          
          # åˆ›å»ºåº”ç”¨é•œåƒï¼ˆapp-image ç±»å‹ï¼Œä¸æ˜¯å®‰è£…åŒ…ï¼‰
          jpackage `
            --type app-image `
            --input target\dist-input `
            --main-jar $jarName `
            --main-class com.laker.postman.App `
            --runtime-image target\runtime `
            --dest target `
            --icon assets\win\EasyPostman.ico `
            --name EasyPostman `
            --app-version $version `
            --vendor "Laker" `
            --copyright "Â© 2025 Laker" `
            --java-options $javaOpts[0] `
            --java-options $javaOpts[1] `
            --java-options $javaOpts[2] `
            --java-options "-Djavax.accessibility.assistive_technologies="

      - name: Package portable versionï¼ˆæ‰“åŒ…ç»¿è‰²ç‰ˆä¸º ZIPï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $appImageDir = "target\EasyPostman"
          $zipName = "EasyPostman-$version-windows-x64-portable.zip"
          
          if (-not (Test-Path "dist")) { New-Item -ItemType Directory -Path "dist" | Out-Null }
          
          # åˆ›å»º .portable æ ‡è¯†æ–‡ä»¶ï¼Œç”¨äºè¿è¡Œæ—¶æ£€æµ‹ä¾¿æºç‰ˆ
          $portableMarker = Join-Path $appImageDir ".portable"
          "This is a portable version" | Out-File -FilePath $portableMarker -Encoding UTF8
          Write-Host "Created .portable marker file"
          
          # å‹ç¼©ä¸º ZIP
          Compress-Archive -Path $appImageDir -DestinationPath "dist\$zipName" -Force
          
          Write-Host "âœ… Created portable version: $zipName"

      - name: Upload to Releaseï¼ˆä¸Šä¼ åˆ° GitHub Releaseï¼‰
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*-portable.zip
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifactï¼ˆæ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        if: github.event_name == 'workflow_dispatch'
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Windows-Portable
          path: dist/*-portable.zip
          retention-days: 7

      - name: Upload Portable ZIP for Gitee syncï¼ˆä¸Šä¼ ä¾¿æºç‰ˆ ZIP ä¾› Gitee åŒæ­¥ä½¿ç”¨ï¼‰
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-portable-zip
          path: dist/*-portable.zip
          retention-days: 1


  build-windows-exe:
    name: Build Windows EXE Installerï¼ˆæ„å»º Windows EXE å®‰è£…ç¨‹åºï¼‰
    runs-on: windows-latest
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false  # ç¦ç”¨æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å… GitHub API é€Ÿç‡é™åˆ¶

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Install Inno Setupï¼ˆå®‰è£… Inno Setupï¼‰
        shell: pwsh
        run: |
          Write-Host "ğŸ“¦ Installing Inno Setup..."
          choco install innosetup -y --no-progress
          
          # åˆ·æ–°ç¯å¢ƒå˜é‡
          $env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")
          
          # éªŒè¯å®‰è£…
          $iscc = Get-Command iscc -ErrorAction SilentlyContinue
          if ($iscc) {
            Write-Host "âœ… Inno Setup installed: $($iscc.Source)"
            # æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼ˆiscc ä¸å¸¦å‚æ•°ä¼šæ˜¾ç¤ºç‰ˆæœ¬å’Œå¸®åŠ©ï¼‰
            & iscc 2>&1 | Select-Object -First 5
          } else {
            Write-Error "âŒ Inno Setup installation failed"
            exit 1
          }

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º Windows ç²¾ç®€ JREï¼‰
        shell: pwsh
        run: |
          $runtimeDir = "target\runtime"
          if (Test-Path $runtimeDir) { Remove-Item -Recurse -Force $runtimeDir }
          
          jlink `
            --add-modules $env:JLINK_MODULES `
            --strip-java-debug-attributes `
            --strip-native-commands `
            --strip-debug `
            --no-header-files `
            --no-man-pages `
            --compress=2 `
            --verbose `
            --output $runtimeDir
          
          # éªŒè¯ JRE å¤§å°
          $size = (Get-ChildItem -Path $runtimeDir -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
          Write-Host "âœ… JRE åˆ›å»ºæˆåŠŸï¼Œå¤§å°: $([math]::Round($size, 2)) MB"

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $jarNameWithVersion = "easy-postman-$version.jar"
          $jarName = "easy-postman.jar"
          
          $distInputDir = "target\dist-input"
          if (Test-Path $distInputDir) { Remove-Item -Recurse -Force $distInputDir }
          New-Item -ItemType Directory -Path $distInputDir | Out-Null
          
          # é‡å‘½å JAR ä¸ºå›ºå®šåç§°ï¼ˆå»é™¤ç‰ˆæœ¬å·ï¼‰
          Copy-Item "target\$jarNameWithVersion" -Destination "$distInputDir\$jarName"

      - name: Create app-image with jpackageï¼ˆåˆ›å»ºåº”ç”¨é•œåƒï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $jarName = "easy-postman.jar"
          
          # è§£æ Java é€‰é¡¹
          $javaOpts = $env:JAVA_OPTIONS -split '\|'
          
          # åˆ›å»ºåº”ç”¨é•œåƒï¼ˆä¾› Inno Setup ä½¿ç”¨ï¼‰
          jpackage `
            --type app-image `
            --input target\dist-input `
            --main-jar $jarName `
            --main-class com.laker.postman.App `
            --runtime-image target\runtime `
            --dest target `
            --icon assets\win\EasyPostman.ico `
            --name EasyPostman `
            --app-version $version `
            --vendor "Laker" `
            --copyright "Â© 2025 Laker" `
            --java-options $javaOpts[0] `
            --java-options $javaOpts[1] `
            --java-options $javaOpts[2] `
            --java-options "-Djavax.accessibility.assistive_technologies="
          
          Write-Host "âœ… App image created at: target\EasyPostman"

      - name: Create EXE with Inno Setupï¼ˆä½¿ç”¨ Inno Setup åˆ›å»º EXE å®‰è£…ç¨‹åºï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $issScript = "build\easy-postman.iss"
          $arch = "x64"  # å½“å‰æ„å»ºä¸º x64ï¼Œæœªæ¥å¯æ‰©å±•ä¸º arm64
          
          # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
          if (-not (Test-Path "dist")) { 
            New-Item -ItemType Directory -Path "dist" | Out-Null 
          }
          
          Write-Host "ğŸ”¨ Building EXE installer with Inno Setup..."
          Write-Host "   Version: $version"
          Write-Host "   Architecture: $arch"
          Write-Host "   Script: $issScript"
          Write-Host "   Source: target\EasyPostman"
          
          # éªŒè¯æºç›®å½•å­˜åœ¨
          if (-not (Test-Path "target\EasyPostman")) {
            Write-Error "âŒ Source directory not found: target\EasyPostman"
            exit 1
          }
          
          # è¿è¡Œ Inno Setup ç¼–è¯‘å™¨
          # æ³¨æ„ï¼šè·¯å¾„ç›¸å¯¹äº ISS è„šæœ¬ä½ç½®ï¼ˆbuild ç›®å½•ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ ..\
          & iscc `
            "/DMyAppVersion=$version" `
            "/DMyAppSourceDir=..\target\EasyPostman" `
            "/DMyOutputDir=..\dist" `
            "/DMyArch=$arch" `
            $issScript
          
          if ($LASTEXITCODE -ne 0) {
            Write-Error "âŒ Inno Setup compilation failed with exit code: $LASTEXITCODE"
            exit 1
          }
          
          # éªŒè¯ EXE æ–‡ä»¶
          $expectedExeName = "EasyPostman-$version-windows-$arch.exe"
          $exeFile = Get-Item "dist\$expectedExeName" -ErrorAction SilentlyContinue
          
          if ($exeFile) {
            Write-Host "âœ… EXE installer created successfully!"
            Write-Host "   File: $($exeFile.Name)"
            Write-Host "   Size: $([math]::Round($exeFile.Length / 1MB, 2)) MB"
            Write-Host "   Path: $($exeFile.FullName)"
          } else {
            Write-Error "âŒ Expected EXE file not found: $expectedExeName"
            Write-Host "Files in dist folder:"
            Get-ChildItem "dist" | ForEach-Object { Write-Host "  - $($_.Name)" }
            exit 1
          }

      - name: Upload to Releaseï¼ˆä¸Šä¼ åˆ° GitHub Releaseï¼‰
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.exe
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifactï¼ˆæ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        if: github.event_name == 'workflow_dispatch'
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Windows-EXE
          path: dist/*.exe
          retention-days: 7

      - name: Upload EXE for Gitee syncï¼ˆä¸Šä¼  EXE ä¾› Gitee åŒæ­¥ä½¿ç”¨ï¼‰
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-exe
          path: dist/*.exe
          retention-days: 1

  build-macos-intel:
    name: Build macOS Intel DMGï¼ˆæ„å»º macOS Intel ç‰ˆå®‰è£…åŒ…ï¼‰
    runs-on: macos-13  # Intel x86_64
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false  # ç¦ç”¨æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å… GitHub API é€Ÿç‡é™åˆ¶

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º macOS Intel ç²¾ç®€ JREï¼‰
        run: |
          rm -rf target/runtime
          # åˆ›å»º macOS Intel å¹³å°çš„ JRE
          jlink \
            --add-modules ${{ env.JLINK_MODULES }} \
            --strip-java-debug-attributes \
            --strip-native-commands \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --verbose \
            --output target/runtime
          
          # éªŒè¯ JRE å¤§å°
          echo "âœ… JRE åˆ›å»ºæˆåŠŸï¼Œå¤§å°: $(du -sh target/runtime | cut -f1)"

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          JAR_NAME_WITH_VERSION="easy-postman-$VERSION.jar"
          JAR_NAME="easy-postman.jar"
          
          rm -rf target/dist-input
          mkdir -p target/dist-input
          # é‡å‘½å JAR ä¸ºå›ºå®šåç§°ï¼ˆå»é™¤ç‰ˆæœ¬å·ï¼‰
          cp target/$JAR_NAME_WITH_VERSION target/dist-input/$JAR_NAME

      - name: Create DMG with jpackageï¼ˆä½¿ç”¨ jpackage åˆ›å»º DMG é•œåƒï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          JAR_NAME="easy-postman.jar"
          
          mkdir -p dist
          
          # è§£æ Java é€‰é¡¹
          IFS='|' read -ra JAVA_OPTS <<< "${{ env.JAVA_OPTIONS }}"
          
          # åˆ›å»º macOS Intel DMG
          jpackage \
            --input target/dist-input \
            --main-jar $JAR_NAME \
            --main-class com.laker.postman.App \
            --runtime-image target/runtime \
            --type dmg \
            --name "EasyPostman" \
            --app-version "$VERSION" \
            --dest dist \
            --icon assets/mac/EasyPostman.icns \
            --vendor "Laker" \
            --copyright "Â© 2025 Laker" \
            --java-options "${JAVA_OPTS[0]}" \
            --java-options "${JAVA_OPTS[1]}" \
            --java-options "${JAVA_OPTS[2]}"
          
          # é‡å‘½åä¸º Intel ç‰ˆæœ¬ï¼ˆä½¿ç”¨æ ‡å‡†æ¶æ„æ ‡è¯†ï¼‰
          mv dist/EasyPostman-$VERSION.dmg dist/EasyPostman-$VERSION-macos-x86_64.dmg
          echo "âœ… Created: EasyPostman-$VERSION-macos-x86_64.dmg"

      - name: Upload to Releaseï¼ˆä¸Šä¼ åˆ° GitHub Releaseï¼‰
        if: github.event_name == 'release'  # åªåœ¨ Release è§¦å‘æ—¶ä¸Šä¼ 
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*-macos-x86_64.dmg
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifactï¼ˆæ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        if: github.event_name == 'workflow_dispatch'  # åªåœ¨æ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸º Artifact
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-macOS-Intel-DMG
          path: dist/*-macos-x86_64.dmg
          retention-days: 7  # ä¿ç•™ 7 å¤©

      - name: Upload DMG for Gitee syncï¼ˆä¸Šä¼  DMG ä¾› Gitee åŒæ­¥ä½¿ç”¨ï¼‰
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-dmg-intel
          path: dist/*-macos-x86_64.dmg
          retention-days: 1

  build-macos-arm:
    name: Build macOS Apple Silicon DMGï¼ˆæ„å»º macOS Apple Silicon ç‰ˆå®‰è£…åŒ…ï¼‰
    runs-on: macos-latest  # Apple Silicon (M1/M2/M3/M4)
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false  # ç¦ç”¨æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å… GitHub API é€Ÿç‡é™åˆ¶

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º macOS ARM ç²¾ç®€ JREï¼‰
        run: |
          rm -rf target/runtime
          # åˆ›å»º macOS ARM å¹³å°çš„ JRE
          jlink \
            --add-modules ${{ env.JLINK_MODULES }} \
            --strip-java-debug-attributes \
            --strip-native-commands \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --verbose \
            --output target/runtime
          
          # éªŒè¯ JRE å¤§å°
          echo "âœ… JRE åˆ›å»ºæˆåŠŸï¼Œå¤§å°: $(du -sh target/runtime | cut -f1)"

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          JAR_NAME_WITH_VERSION="easy-postman-$VERSION.jar"
          JAR_NAME="easy-postman.jar"
          
          rm -rf target/dist-input
          mkdir -p target/dist-input
          # é‡å‘½å JAR ä¸ºå›ºå®šåç§°ï¼ˆå»é™¤ç‰ˆæœ¬å·ï¼‰
          cp target/$JAR_NAME_WITH_VERSION target/dist-input/$JAR_NAME

      - name: Create DMG with jpackageï¼ˆä½¿ç”¨ jpackage åˆ›å»º DMG é•œåƒï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          JAR_NAME="easy-postman.jar"
          
          mkdir -p dist
          
          # è§£æ Java é€‰é¡¹
          IFS='|' read -ra JAVA_OPTS <<< "${{ env.JAVA_OPTIONS }}"
          
          # åˆ›å»º macOS Apple Silicon DMG
          jpackage \
            --input target/dist-input \
            --main-jar $JAR_NAME \
            --main-class com.laker.postman.App \
            --runtime-image target/runtime \
            --type dmg \
            --name "EasyPostman" \
            --app-version "$VERSION" \
            --dest dist \
            --icon assets/mac/EasyPostman.icns \
            --vendor "Laker" \
            --copyright "Â© 2025 Laker" \
            --java-options "${JAVA_OPTS[0]}" \
            --java-options "${JAVA_OPTS[1]}" \
            --java-options "${JAVA_OPTS[2]}"
          
          # é‡å‘½åä¸º ARM ç‰ˆæœ¬ï¼ˆä½¿ç”¨æ ‡å‡†æ¶æ„æ ‡è¯†ï¼‰
          mv dist/EasyPostman-$VERSION.dmg dist/EasyPostman-$VERSION-macos-arm64.dmg
          echo "âœ… Created: EasyPostman-$VERSION-macos-arm64.dmg"

      - name: Upload to Releaseï¼ˆä¸Šä¼ åˆ° GitHub Releaseï¼‰
        if: github.event_name == 'release'  # åªåœ¨ Release è§¦å‘æ—¶ä¸Šä¼ 
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*-macos-arm64.dmg
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifactï¼ˆæ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        if: github.event_name == 'workflow_dispatch'  # åªåœ¨æ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸º Artifact
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-macOS-ARM-DMG
          path: dist/*-macos-arm64.dmg
          retention-days: 7  # ä¿ç•™ 7 å¤©

      - name: Upload DMG for Gitee syncï¼ˆä¸Šä¼  DMG ä¾› Gitee åŒæ­¥ä½¿ç”¨ï¼‰
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-dmg-arm64
          path: dist/*-macos-arm64.dmg
          retention-days: 1

  build-jar:
    name: Build Standalone JARï¼ˆæ„å»ºç‹¬ç«‹ JAR åŒ…ï¼‰
    runs-on: ubuntu-latest
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Download JAR artifactï¼ˆä¸‹è½½å·²æ„å»ºçš„ JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: dist

      - name: Upload to Releaseï¼ˆä¸Šä¼ åˆ° GitHub Releaseï¼‰
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.jar
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifactï¼ˆæ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        if: github.event_name == 'workflow_dispatch'
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Standalone-JAR
          path: dist/*.jar
          retention-days: 7



  build-ubuntu:
    name: Build Ubuntu DEBï¼ˆæ„å»º Ubuntu å®‰è£…åŒ…ï¼‰
    runs-on: ubuntu-22.04
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false  # ç¦ç”¨æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å… GitHub API é€Ÿç‡é™åˆ¶

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Install dependenciesï¼ˆå®‰è£…ç³»ç»Ÿä¾èµ–ï¼‰
        run: |
          sudo apt-get update
          # å®‰è£… GTK3ã€WebKit å’Œæ‰“åŒ…å·¥å…·
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.0-dev binutils

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º Linux ç²¾ç®€ JREï¼‰
        run: |
          rm -rf target/runtime
          # åˆ›å»º Linux å¹³å°çš„ JRE
          jlink \
            --add-modules ${{ env.JLINK_MODULES }} \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --output target/runtime

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          JAR_NAME_WITH_VERSION="easy-postman-$VERSION.jar"
          JAR_NAME="easy-postman.jar"
          
          rm -rf target/dist-input
          mkdir -p target/dist-input
          # é‡å‘½å JAR ä¸ºå›ºå®šåç§°ï¼ˆå»é™¤ç‰ˆæœ¬å·ï¼‰
          cp target/$JAR_NAME_WITH_VERSION target/dist-input/$JAR_NAME

      - name: Create DEB with jpackageï¼ˆä½¿ç”¨ jpackage åˆ›å»º DEB å®‰è£…åŒ…ï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          JAR_NAME="easy-postman.jar"
          
          mkdir -p dist
          
          # è§£æ Java é€‰é¡¹
          IFS='|' read -ra JAVA_OPTS <<< "${{ env.JAVA_OPTIONS }}"
          
          # åˆ›å»º Ubuntu/Debian DEB å®‰è£…åŒ…
          jpackage \
            --input target/dist-input \
            --main-jar $JAR_NAME \
            --main-class com.laker.postman.App \
            --runtime-image target/runtime \
            --type deb \
            --name "EasyPostman" \
            --app-version "$VERSION" \
            --dest dist \
            --vendor "Laker" \
            --copyright "Â© 2025 Laker" \
            --description "A modern API testing tool similar to Postman" \
            --linux-shortcut \
            --linux-menu-group "Development" \
            --linux-app-category "Development" \
            --java-options "${JAVA_OPTS[0]}" \
            --java-options "${JAVA_OPTS[1]}" \
            --java-options "${JAVA_OPTS[2]}"

      - name: Upload to Releaseï¼ˆä¸Šä¼ åˆ° GitHub Releaseï¼‰
        if: github.event_name == 'release'  # åªåœ¨ Release è§¦å‘æ—¶ä¸Šä¼ 
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.deb
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload as Artifactï¼ˆæ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        if: github.event_name == 'workflow_dispatch'  # åªåœ¨æ‰‹åŠ¨è§¦å‘æ—¶ä¸Šä¼ ä¸º Artifact
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Ubuntu-DEB
          path: dist/*.deb
          retention-days: 7  # ä¿ç•™ 7 å¤©

      - name: Upload DEB for Gitee syncï¼ˆä¸Šä¼  DEB ä¾› Gitee åŒæ­¥ä½¿ç”¨ï¼‰
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v4
        with:
          name: release-deb
          path: dist/*.deb
          retention-days: 1

  # åˆ›å»º Gitee Releaseï¼ˆWindows ç»¿è‰²ç‰ˆæ„å»ºå®Œæˆåç«‹å³åˆ›å»ºï¼‰
  create-gitee-release:
    name: Create Gitee Releaseï¼ˆåˆ›å»º Gitee Releaseï¼‰
    if: github.event_name == 'release'
    needs: [ build-windows-portable, build-windows-exe ]  # ç­‰å¾… Windows ç»¿è‰²ç‰ˆå’Œ EXE æ„å»ºå®Œæˆ
    runs-on: ubuntu-latest
    outputs:
      release_id: ${{ steps.gitee_release.outputs.release_id }}
      tag_name: ${{ steps.get_version.outputs.tag }}

    steps:
      - name: Get version from tagï¼ˆä»æ ‡ç­¾è·å–ç‰ˆæœ¬å·ï¼‰
        id: get_version
        run: |
          TAG_NAME="${{ github.event.release.tag_name }}"
          VERSION="${TAG_NAME#v}"  # ç§»é™¤ v å‰ç¼€
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "tag=$TAG_NAME" >> $GITHUB_OUTPUT

      - name: Create Gitee Releaseï¼ˆåˆ›å»º Gitee Releaseï¼‰
        id: gitee_release
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          TAG_NAME="${{ steps.get_version.outputs.tag }}"
          RELEASE_BODY="${{ github.event.release.body }}"
          
          if [ -z "$RELEASE_BODY" ]; then
            RELEASE_BODY="EasyPostman ${VERSION} å‘å¸ƒç‰ˆæœ¬ï¼Œæ”¯æŒ Windowsã€macOS å’Œ Linuxã€‚è¯¦æƒ…ï¼šhttps://github.com/lakernote/easy-postman"
          fi
          
          echo "ğŸš€ Creating Gitee Release for tag: $TAG_NAME"
          
          curl -s -X POST \
            -F "access_token=${{ secrets.GITEE_TOKEN }}" \
            -F "tag_name=$TAG_NAME" \
            -F "name=$TAG_NAME" \
            -F "body=$RELEASE_BODY" \
            -F "prerelease=false" \
            -F "target_commitish=master" \
            "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases" > /tmp/release.json
          
          echo "API Response:"
          cat /tmp/release.json
          
          # ä¼˜å…ˆä½¿ç”¨ jqï¼ˆGitHub Actions Ubuntu runner é¢„è£…ï¼‰
          RELEASE_ID=$(jq -r '.id // empty' /tmp/release.json 2>/dev/null || echo "")
          
          if [ -z "$RELEASE_ID" ]; then
            echo "jq extraction failed, trying python3..."
            RELEASE_ID=$(python3 -c "import sys, json; print(json.load(open('/tmp/release.json'))['id'])" 2>/dev/null || echo "")
          fi
          
          if [ -z "$RELEASE_ID" ]; then
            echo "python3 failed, trying grep..."
            RELEASE_ID=$(grep -o '"id":[0-9]*' /tmp/release.json | head -1 | grep -o '[0-9]*')
          fi
          
          if [ -z "$RELEASE_ID" ]; then
            echo "Error: Failed to create release or extract release ID"
            exit 1
          fi
          
          echo "release_id=$RELEASE_ID" >> $GITHUB_OUTPUT
          echo "âœ… Gitee Release created successfully with ID: $RELEASE_ID"

  # Windows ç»¿è‰²ç‰ˆä¸Šä¼ åˆ° Gitee
  sync-windows-portable-to-gitee:
    name: Upload Windows Portable to Giteeï¼ˆä¸Šä¼  Windows ç»¿è‰²ç‰ˆåˆ° Giteeï¼‰
    if: github.event_name == 'release'
    needs: [ create-gitee-release ]
    runs-on: ubuntu-latest

    steps:
      - name: Download Windows Portable artifactï¼ˆä¸‹è½½ Windows ç»¿è‰²ç‰ˆäº§ç‰©ï¼‰
        uses: actions/download-artifact@v4
        with:
          name: release-portable-zip
          path: artifacts

      - name: Upload Windows Portable to Giteeï¼ˆä¸Šä¼  Windows ç»¿è‰²ç‰ˆåˆ° Giteeï¼‰
        run: |
          RELEASE_ID="${{ needs.create-gitee-release.outputs.release_id }}"
          FILE=$(find artifacts -name "*-portable.zip" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "âŒ Windows Portable ZIP file not found!"
            exit 1
          fi
          
          echo "ğŸ“¦ [Priority 1] Uploading $(basename $FILE) to Gitee..."
          
          # ä¸Šä¼ åˆ° Giteeï¼Œå¸¦é‡è¯•æœºåˆ¶
          MAX_RETRIES=3
          RETRY_COUNT=0
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            if curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
              -F "access_token=${{ secrets.GITEE_TOKEN }}" \
              -F "file=@$FILE"; then
              echo "âœ… Windows Portable uploaded successfully!"
              exit 0
            else
              RETRY_COUNT=$((RETRY_COUNT + 1))
              if [ $RETRY_COUNT -lt $MAX_RETRIES ]; then
                echo "âš ï¸ Upload failed, retrying ($RETRY_COUNT/$MAX_RETRIES)..."
                sleep 5
              fi
            fi
          done
          
          echo "âŒ Failed to upload Windows Portable after $MAX_RETRIES attempts"
          exit 1

  # Windows EXE ä¸Šä¼ åˆ° Gitee
  sync-windows-exe-to-gitee:
    name: Upload Windows EXE to Giteeï¼ˆä¸Šä¼  Windows EXE åˆ° Giteeï¼‰
    if: github.event_name == 'release'
    needs: [ create-gitee-release ]
    runs-on: ubuntu-latest

    steps:
      - name: Download Windows EXE artifactï¼ˆä¸‹è½½ Windows EXE äº§ç‰©ï¼‰
        uses: actions/download-artifact@v4
        with:
          name: release-exe
          path: artifacts

      - name: Upload Windows EXE to Giteeï¼ˆä¸Šä¼  Windows EXE åˆ° Giteeï¼‰
        run: |
          RELEASE_ID="${{ needs.create-gitee-release.outputs.release_id }}"
          FILE=$(find artifacts -name "*.exe" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "âŒ Windows EXE file not found!"
            exit 1
          fi
          
          echo "ğŸ“¦ [Priority 2] Uploading $(basename $FILE) to Gitee..."
          
          # ä¸Šä¼ åˆ° Giteeï¼Œå¸¦é‡è¯•æœºåˆ¶
          MAX_RETRIES=3
          RETRY_COUNT=0
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            if curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
              -F "access_token=${{ secrets.GITEE_TOKEN }}" \
              -F "file=@$FILE"; then
              echo "âœ… Windows EXE uploaded successfully!"
              exit 0
            else
              RETRY_COUNT=$((RETRY_COUNT + 1))
              if [ $RETRY_COUNT -lt $MAX_RETRIES ]; then
                echo "âš ï¸ Upload failed, retrying ($RETRY_COUNT/$MAX_RETRIES)..."
                sleep 5
              fi
            fi
          done
          
          echo "âŒ Failed to upload Windows EXE after $MAX_RETRIES attempts"
          exit 1

  # macOS ARM ä¸Šä¼ åˆ° Giteeï¼ˆmacOS æ„å»ºå®Œæˆåç«‹å³ä¸Šä¼ ï¼‰
  sync-macos-to-gitee:
    name: Upload macOS ARM to Giteeï¼ˆä¸Šä¼  macOS ARM åˆ° Giteeï¼‰
    if: github.event_name == 'release'
    # âœ… åªç­‰å¾… 2 ä¸ªæ¡ä»¶ï¼š
    # 1. create-gitee-release å®Œæˆï¼ˆè·å¾— release_idï¼‰
    # 2. build-macos-arm å®Œæˆï¼ˆDMG æ–‡ä»¶å‡†å¤‡å¥½ï¼‰
    needs: [ create-gitee-release, build-macos-arm ]
    runs-on: ubuntu-latest

    steps:
      - name: Download macOS ARM artifactï¼ˆä¸‹è½½ macOS ARM äº§ç‰©ï¼‰
        uses: actions/download-artifact@v4
        with:
          name: release-dmg-arm64
          path: artifacts

      - name: Upload macOS ARM to Giteeï¼ˆä¸Šä¼  macOS ARM åˆ° Giteeï¼‰
        run: |
          RELEASE_ID="${{ needs.create-gitee-release.outputs.release_id }}"
          FILE=$(find artifacts -name "*-macos-arm64.dmg" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "âŒ macOS ARM DMG file not found!"
            exit 1
          fi
          
          echo "ğŸ [Priority 3] Uploading $(basename $FILE) to Gitee..."
          
          # ä¸Šä¼ åˆ° Giteeï¼Œå¸¦é‡è¯•æœºåˆ¶
          MAX_RETRIES=3
          RETRY_COUNT=0
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            if curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
              -F "access_token=${{ secrets.GITEE_TOKEN }}" \
              -F "file=@$FILE"; then
              echo "âœ… macOS ARM uploaded successfully!"
              exit 0
            else
              RETRY_COUNT=$((RETRY_COUNT + 1))
              if [ $RETRY_COUNT -lt $MAX_RETRIES ]; then
                echo "âš ï¸ Upload failed, retrying ($RETRY_COUNT/$MAX_RETRIES)..."
                sleep 5
              fi
            fi
          done
          
          echo "âŒ Failed to upload macOS ARM after $MAX_RETRIES attempts"
          exit 1

  # æ±‡æ€»ç»“æœ
  sync-summary:
    name: Sync Summaryï¼ˆåŒæ­¥æ±‡æ€»ï¼‰
    if: github.event_name == 'release' && always()  # å³ä½¿æœ‰å¤±è´¥ä¹Ÿæ‰§è¡Œ
    needs: [ create-gitee-release, sync-windows-portable-to-gitee, sync-windows-exe-to-gitee, sync-macos-to-gitee ]
    runs-on: ubuntu-latest

    steps:
      - name: Summaryï¼ˆæ±‡æ€»ï¼‰
        run: |
          echo "ğŸ“Š Gitee Release åŒæ­¥å®Œæˆï¼"
          echo "ğŸ“ Release URL: https://gitee.com/lakernote/easy-postman/releases/${{ needs.create-gitee-release.outputs.tag_name }}"
          echo ""
          echo "â±ï¸  åŒæ­¥æ—¶é—´çº¿ï¼ˆå®Œå…¨å¹¶è¡Œï¼‰ï¼š"
          echo "  1ï¸âƒ£  Windows Portable å’Œ EXE æ„å»ºå®Œæˆ â†’ ç«‹å³åˆ›å»º Gitee Release â†’ ç«‹å³ä¸Šä¼ ç»¿è‰²ç‰ˆå’Œ EXE âœ…"
          echo "  2ï¸âƒ£  macOS ARM æ„å»ºå®Œæˆ â†’ ç«‹å³ä¸Šä¼  DMG âœ…"
          echo ""
          echo "å·²åŒæ­¥åˆ° Gitee çš„æ–‡ä»¶ï¼š"
          echo "  ğŸ“¦ Windows Portable (ç»¿è‰²ç‰ˆ) - ${{ needs.sync-windows-portable-to-gitee.result }}"
          echo "  ğŸªŸ Windows EXE (å®‰è£…åŒ…) - ${{ needs.sync-windows-exe-to-gitee.result }}"
          echo "  ğŸ macOS Apple Silicon (ARM64) - ${{ needs.sync-macos-to-gitee.result }}"
          echo ""
          echo "ğŸ’¡ å…¶ä»–å¹³å°ï¼ˆStandalone JARã€macOS Intelã€Ubuntu DEBï¼‰ä»…åœ¨ GitHub Release æä¾›"
          echo ""
          PORTABLE_STATUS="${{ needs.sync-windows-portable-to-gitee.result }}"
          EXE_STATUS="${{ needs.sync-windows-exe-to-gitee.result }}"
          MACOS_STATUS="${{ needs.sync-macos-to-gitee.result }}"
          
          if [ "$PORTABLE_STATUS" == "success" ] && [ "$EXE_STATUS" == "success" ] && [ "$MACOS_STATUS" == "success" ]; then
            echo "âœ… æ‰€æœ‰é…ç½®å¹³å°å‡å·²æˆåŠŸä¸Šä¼ åˆ° Giteeï¼"
            echo "ğŸš€ ä¼˜åŒ–ï¼š"
            echo "   â€¢ Windows æä¾›ç»¿è‰²ç‰ˆï¼ˆè§£å‹å³ç”¨ï¼‰å’Œ EXE å®‰è£…åŒ…ï¼ˆæ”¯æŒè‡ªåŠ¨å‡çº§ï¼‰"
            echo "   â€¢ macOS ARM åŸç”Ÿæ”¯æŒï¼Œæ€§èƒ½æ›´ä¼˜"
            echo "   â€¢ å„å¹³å°å®Œå…¨å¹¶è¡Œä¸Šä¼ ï¼Œå¿«é€Ÿå‘å¸ƒ"
